#!/usr/bin/env php
<?php

require __DIR__.'/vendor/autoload.php';

use Orchestra\Testbench\Console\Commander;
use Orchestra\Testbench\Foundation\Config;
use Dotenv\Dotenv;

$workingPath = __DIR__;

// Загружаем .env если он существует, чтобы переменные были доступны в приложении
if (file_exists($workingPath.'/.env')) {
    if (class_exists(Dotenv::class)) {
        $dotenv = Dotenv::createImmutable($workingPath);
        $dotenv->safeLoad();
    }
}

if (!defined('TESTBENCH_CORE')) {
    define('TESTBENCH_CORE', true);
}
if (!defined('TESTBENCH_WORKING_PATH')) {
    define('TESTBENCH_WORKING_PATH', $workingPath);
}

// Загружаем конфигурацию Testbench
$config = Config::loadFromYaml(
    workingPath: $workingPath,
    defaults: [
        'providers' => [],
        'dont-discover' => [],
    ],
);

// Запускаем Commander Orchestra Testbench
exit((new Commander($config, $workingPath))->handle());
